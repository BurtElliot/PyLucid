{% extends "pylucid/css_anchor_div.html" %}


{% block plugin_content %}

{% extrahead %}
<style type="text/css">
<!--
{% if not preview_html %}
{# Hide preview div only, if no preview html content exist. #}
#preview_fieldset {
    display: none;
}
{% endif %}
#ajax_preview { /* hide Ajax preview button and unhide it with JS */
    display: none;
}
-->
</style>

<script type="text/javascript">
$(document).ready(function(){
    $("#ajax_preview").show(); // unhide ajax preview button
   
    // from media/PyLucid/pylucid_js_tools.js
    pylucid_ajax_form_view('#edit_page_form');
    replace_openinwindow_links();
    
    var preview_div = $("#edit_page_preview");
    
    $("#ajax_preview").click(function() {
        $("#edit_page_preview").html("<h2>loading...</h2>");
        $("#preview_fieldset").slideDown();
    
        var content = $("#id_content")[0].value;
    
        var url = encodeURI("{{ preview_url }}");
        log("post:" + url);
        log("content:" + content);
        
        $.post(url, { "content": content, "preview": true }, function(form_html){
            preview_div.html(form_html);
        });
    });
    $("#submit_preview").hide();    
});
</script>
{% endextrahead %}

<fieldset id="preview_fieldset">
<legend>{% trans 'Preview' %}</legend>
<div id="edit_page_preview">{{ preview_html }}</div>
</fieldset>

<fieldset>
<legend>
    {% trans 'Edit the CMS page' %} '<strong>{{ pagemeta.get_title|escape }}</strong>'
</legend>
<form action="{{ form_url }}" method="post" id="edit_page_form">   
 <div class="helper_buttons">
     <input type="submit" name="save" value="{% trans 'save' %}" />
     <input type="submit" id="submit_preview" name="preview" value="{% trans 'markup preview' %}" />
     <button type="button" id="ajax_preview" title="{% trans 'markup preview' %}">
         {% trans 'markup preview' %}
     </button>
     <input onclick="self.location.href='{{ abort_url }}'" name="abort" value="{% trans 'abort' %}" type="reset" />
     <a href="{{ pagelinklist_url }}" class="openinwindow" title="{% trans 'List of all pages for creating links' %}">
         <button type="button" class="button">{% trans 'page list' %}</button>
     </a>
     <a href="{% url PageAdmin-tag_list %}" class="openinwindow" title="{% trans 'List of all available PyLucid template tags' %}">
         <button type="button" class="button">{% trans 'tag list' %}</button>
     </a>
     <button type="button" class="button resize_textarea" id="bigger_id_content" title="{% trans 'makes the textarea bigger' %}">
         +
     </button>
     <button type="button" class="button resize_textarea" id="smaller_id_content" title="{% trans 'makes the textarea smaller' %}">
         -
     </button>
 </div>   
{% with edit_page_form as form %}
    {% include "admin/pylucid/includes/pylucid_formset.html" %}
{% endwith %}
</form>
</fieldset>
{% endblock %}